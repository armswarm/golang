platform: linux/arm

clone:
  git:
    image: armswarmdrone/git

pipeline:
  prepare:
    image: quay.io/armswarm/alpine:3.6
    environment:
      - ALPINE_VERSION=3.6
      - GOLANG_VERSION=1.9.0
      - GOLANG_PACKAGE=1.9-r2
    commands:
      - |-
          sed -i \
            -e "s/{{GOLANG_VERSION}}/${GOLANG_VERSION}/" \
            -e "s/{{GOLANG_PACKAGE}}/${GOLANG_PACKAGE}/" \
            -e "s/{{ALPINE_VERSION}}/${ALPINE_VERSION}/" \
            Dockerfile

  build_and_publish:
    image: armswarmdrone/docker
    repo: quay.io/armswarm/golang
    tag: [ "1.9.0-alpine", "1.9-alpine", "1-alpine", "alpine" ]
    privileged: true
    when:
      branch: master
      event: push

  notify:
    image: armswarmdrone/slack
    when:
      status: [ failure, success ]
